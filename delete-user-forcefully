# --------------------------
# Ensure script runs as admin
# --------------------------
if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltinRole]::Administrator)) {
    Write-Host "Restarting script as Administrator..."
    Start-Process powershell "-NoProfile -ExecutionPolicy Bypass -File `"$PSCommandPath`"" -Verb RunAs
    exit
}

# --------------------------
# Your original script starts here
# --------------------------
# Set the username you want to delete
$user = "Shashank"

# Check if the user exists
if (Get-LocalUser -Name $user -ErrorAction SilentlyContinue) {

    Write-Host "Trying to remove user $user..."

    # Remove from all local groups
    $groups = Get-LocalGroup
    foreach ($g in $groups) {
        try {
            Remove-LocalGroupMember -Group $g.Name -Member $user -ErrorAction SilentlyContinue
        } catch {}
    }

    # Force delete the profile folder (optional)
    $profilePath = "C:\Users\$user"
    if (Test-Path $profilePath) {
        Write-Host "Removing user profile at $profilePath..."
        Remove-Item -Path $profilePath -Recurse -Force -ErrorAction SilentlyContinue
    }

    # Remove local user
    try {
        Remove-LocalUser -Name $user -ErrorAction Stop
        Write-Host "User $user removed successfully."
    }
    catch {
        Write-Host "Failed to remove user normally. Trying WMI method..."

        # Alternate force-removal via WMI
        Get-WmiObject Win32_UserAccount -Filter "Name='$user'" |
            Remove-WmiObject -ErrorAction SilentlyContinue

        Write-Host "User removal attempt completed using WMI."
    }

}
else {
    Write-Host "User $user does not exist."
}
